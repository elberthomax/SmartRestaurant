<!doctype html>
<html>
<head>
    <title>Billing</title>
    <link rel="stylesheet" href="css/Bill-style.css">
</head>

<body>
    <input id="idInput" type="text" value="">
    <button type="button" onclick="getBill()">request bill</button>
    <div id="Bill">
        <h1 style="text-align: center;">TABLE 3</h1>
        <table id="Nilai" cellpadding="0" cellspacing="0">
            <tr class="top">
                <td colspan="3">
                    <table>
                        <tr>
                            <td class="title">
                                <img src="images/logobilling.png" style="width:15%; ">
                            </td>
                            <td>
                                Bill #: 123<br>
                                Created: <span id="date"></span><br>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>

            <tr class="information">
                <td colspan="3">
                    <table>
                        <tr>
                            <td>
                                NoName Resto<br>
                                Hertasning<br>
                                0812 3456 7890
                            </td>

                            <td>
                                <br>
                                ElbertThomax<br>
                                NoNameResto@email.com
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>


        <div>
            <table id = "isi">
            </table>
        </div>
    </div>
    <script type="text/javascript">
        let urlSetPaid = "http://stevelukis.com/smart-restaurant/backend/cashier/paid";
        let urlGetBill = "http://stevelukis.com/smart-restaurant/backend/cashier/get_orders";
        let id = 0;

        function sendPost(url, data, callback){
            let xhr = new XMLHttpRequest();
            xhr.open("POST", url, true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    callback(JSON.parse(xhr.responseText));
                }
            };
            xhr.send(JSON.stringify(data));
        }

        function confirmPayment(){
            sendPost(urlSetPaid,{"id": id},function(response){
                alert(`success id: ${id}`);
                document.getElementById("Bill").style.display = "none";
            });
        }

        function getBill(){
            let tableNumber = document.getElementById("idInput").value;
            let data = { "table_number": tableNumber };
            sendPost(urlGetBill, data, function(response){
                document.getElementById("date").innerHTML = (new Date()).toString().split(' ').splice(1,3).join(' ');
                id = response[0]["user_id"];
                let total = 0;
                let text = `
                <tr class="heading">
                    <td>Item</td>
                    <td>Quantity</td>
                    <td>Price</td>
                </tr>`;
                response.forEach(function(item){
                    total += item["price"]*item["quantity"];
                    text += `
                    <tr class="item">
                        <td>${item["menu_name"]}</td>
                        <td>${item["quantity"]}</td>
                        <td>Rp. ${(item["price"]*item["quantity"]).toLocaleString('en')}</td>
                    </tr>`
                });
                text += `
                <tr class="total">
                    <td></td>
                    <td>Total:</td>
                    <td>Rp. ${total.toLocaleString('en')}</td>
                </tr>
                <tr class="total">
                    <td></td>
                    <td></td>
                    <td>
                        <button type="button" onclick="confirmPayment()">Pay</button>
                    </td>
                </tr>`;
                document.getElementById("isi").innerHTML = text;
                document.getElementById("Bill").style.display = "inline";
            });
        }
    </script>
</body>
</html>
